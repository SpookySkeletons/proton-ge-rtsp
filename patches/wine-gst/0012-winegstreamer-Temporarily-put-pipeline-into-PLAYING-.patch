From 0a6d620b944db4e7c709e129b27869c0500ce54a Mon Sep 17 00:00:00 2001
From: Torge Matthies <openglfreak@googlemail.com>
Date: Wed, 31 Jan 2024 17:42:55 +0100
Subject: [PATCH 12/13] winegstreamer: Temporarily put pipeline into PLAYING
 state while waiting for the no-more-pads callback.

Some elements (RTSP) won't send no-more-pads in READY/PAUSED state.
---
 dlls/winegstreamer/wg_parser.c | 14 ++++++++++++++
 1 file changed, 14 insertions(+)

diff --git a/dlls/winegstreamer/wg_parser.c b/dlls/winegstreamer/wg_parser.c
index 64ebc5f42a8..729c983edd1 100644
--- a/dlls/winegstreamer/wg_parser.c
+++ b/dlls/winegstreamer/wg_parser.c
@@ -1714,8 +1714,22 @@ static NTSTATUS wg_parser_connect(void *args)
 
     pthread_mutex_lock(&parser->mutex);
 
+    if (parser->uri)
+    {
+        gst_element_set_state(parser->container, GST_STATE_PLAYING);
+        ret = gst_element_get_state(parser->container, NULL, NULL, -1);
+        if (ret == GST_STATE_CHANGE_FAILURE)
+            goto out;
+    }
     while (!parser->no_more_pads && !parser->error)
         pthread_cond_wait(&parser->init_cond, &parser->mutex);
+    if (parser->uri)
+    {
+        gst_element_set_state(parser->container, GST_STATE_PAUSED);
+        ret = gst_element_get_state(parser->container, NULL, NULL, -1);
+        if (ret == GST_STATE_CHANGE_FAILURE)
+            goto out;
+    }
     if (parser->error)
     {
         if (!parser->use_mediaconv && parser->init_gst == decodebin_parser_init_gst)
-- 
2.43.0

